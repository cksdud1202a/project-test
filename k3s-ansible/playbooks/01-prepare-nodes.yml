---
- name: Prepare all nodes for K3s
  hosts: servers,agents # 인벤토리에서 변경한 그룹명을 사용합니다.
  become: true
  gather_facts: true

# [전처리 태스크] 롤(Role)이 실행되기 전에 ARM 환경에 부족한 패키지를 먼저 설치합니다.
  pre_tasks:
    - name: Update apt cache
      apt:
        update_cache: yes

    - name: Install python3-pip and essential tools for ARM
      apt:
        name:
          - python3-pip
          - curl
          - git
        state: present

    - name: Install kubernetes python library for Ansible modules
      pip:
        name:
          - kubernetes
          - PyYAML
        executable: pip3
  
  # K3s 설치 전 필수적인 공통 환경만 정리합니다.
  roles:
    - k3s-common
